<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>AWS SDK for JavaScript - Browser Getting Started Application</title>
    <link rel="stylesheet" href="aws.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>

  <body>
    <body class="body">
    
      <div class="container py5">
  
          <div class="text-center">
              <h2 class="display-7">PRODUCTS</h2>
          </div>
  
          <div class="row">
              <ul id="home_product"></ul>
          </div>
  
      </div>
  
  </body>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.410.0.min.js"></script>
    <script type="text/javascript">

        // Initialize the Amazon Cognito credentials provider
        AWS.config.region = 'eu-west-1'; // RÃ©gion
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
    IdentityPoolId: 'eu-west-1:a40474e9-d90b-494d-836d-7e55d8f9da3b',
});

AWS.config.getCredentials(function(err) {
  if (err) console.log(err.stack);
  
  // credentials not loaded
  else {
    console.log("Access key:", AWS.config.credentials.accessKeyId);
    const itemsAll = scanAll("VideoAWS");
    itemsAll.then(function(value) {
      for(var i =0;i<100000;i++){
        if(value[i]!== undefined){
      console.log(value[i]);
      loadProducts(value[i]);

      var file = "https://"+value[i].srcBucket+".s3."+AWS.config.region+".amazonaws.com/"+value[i].srcVideo;
      console.log(file);

    }
      }
    // expected output: 123
});

  }
});

const documentClient = new AWS.DynamoDB.DocumentClient();

const scanAll = async (tableName) => {
  let lastEvaluatedKey = 'dummy'; // string must not be empty
  const itemsAll = [];
  let table = { TableName: tableName };


  while (lastEvaluatedKey) {
    const data = await documentClient.scan(table).promise();
    itemsAll.push(...data.Items);
    lastEvaluatedKey = data.LastEvaluatedKey;
    if (lastEvaluatedKey) {
      table.ExclusiveStartKey = lastEvaluatedKey;
    }
  }
  return itemsAll;
}


function loadProducts(data){

var li = document.createElement('li');
var MESSAGE_TEMPLATE =
  '<div class="message-container">' +
  '<div class="spacing">  <div class="circle"><img src="" alt=""/><svg viewBox="0 0 100 100" xmlns="" style="enable-background:new -580 439 577.9 194;"xml:space="preserve"> <circle cx="50" cy="50" r="40" /></svg></div></div>' +
  '<div class="message"></div>' +
  '<div class="name"></div>' +
  '</div>';

li.innerHTML = MESSAGE_TEMPLATE

li.setAttribute('id', data.guid);

li.querySelector(".message").myParam = "test";

li.querySelector(".message").addEventListener('click', myFunc, false);

var file = "https://"+data.srcBucket+".s3."+AWS.config.region+".amazonaws.com/"+data.srcVideo;
console.log(file);

document.getElementById("home_product").appendChild(li);
    }

     function myFunc(evt) {
  var test = evt.currentTarget.myParam;
console.log(test);
}
    </script>
  </body>
</html>